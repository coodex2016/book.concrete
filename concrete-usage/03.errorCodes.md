# 异常信息

`concrete`的理念是，服务根据传入数据给出结果，我们称之为“正常”，其他情况都是异常，每个异常给定一个异常码和异常信息，由调用者决定如何处理。

我们通过一个示例来进行说明。

我们设计一个新的AddService，它负责处理个位数加法，超出范围时，给调用者返回一个太难了的异常信息。

在`demo-api`模块中，定义一个`DemoErrorCodes`类，用来放异常码常量

```java
package org.coodex.concrete.demo.api;

import org.coodex.concrete.common.AbstractErrorCodes;

public class DemoErrorCodes extends AbstractErrorCodes {

    protected static final int DEMO_BASED = CUSTOM_LOWER_BOUND + 5000;

    public static final int TOO_HARD = DEMO_BASED + 1;
}
```

新建十以内加法服务

```java
package org.coodex.concrete.demo.api;

import org.coodex.concrete.api.ConcreteService;
import org.coodex.concrete.api.Description;

@ConcreteService
@Description(name = "十以内加法")
public interface AddWithIn10Service {

    Integer add(Integer x1, Integer x2);
}

```

在`demo-api`的资源目录中`i18n`目录下定义异常信息模板

- `message.yml`

```yml
message:
  105001: "{0} + {1} is too hard >_<"
```

- `message_zh_CN.yml`

```yml
message:
  105001: "{0} + {1} 太难了 >_<"
```


在`demo-impl`模块增加实现。先增加`concrete-core`的依赖，在`concrete-core`中，对ErrorCode规范有一套默认实现，开箱即用。

```xml
        <!-- 使用concrete的工具链 -->
        <dependency>
            <groupId>org.coodex</groupId>
            <artifactId>concrete-core</artifactId>
        </dependency>
```

实现类

```java
package org.coodex.concrete.demo.impl;

import org.coodex.concrete.common.IF;
import org.coodex.concrete.demo.api.AddWithIn10Service;

import javax.inject.Named;

import static org.coodex.concrete.demo.api.DemoErrorCodes.TOO_HARD;

@Named
public class AddWithIn10ServiceImpl implements AddWithIn10Service {

    @Override
    public Integer add(Integer x1, Integer x2) {
        // IF是concrete工具链提供的工具之一
        // 下面的接口就是说，如果满足条件（参数1），则抛出TOO_HARD异常(参数2)，并传入信息渲染的参数（参数3，可变参数）
        IF.is(x1 < 0 || x1 > 9 || x2 < 0 || x2 > 9,
                TOO_HARD,
                x1, x2);
        return x1 + x2;
    }
}
```

还有个工作，上一步中，我们开启了mock，因此需要把这个服务例外出来

`demo-boot`的test作用域中的`mock.excepted`中增加
```
org.coodex.concrete.demo.api.AddWithIn10Service
```

跑起来，然后用swagger试试

x1=1,x2=2，结果是正确的，3
x1=10,x2=2，结果如下：

![](../images/addWithIn10.png)

切换一下浏览器的语言顺序，把英语提前，你会看到信息变成了

```json
{
  "code": 105001,
  "msg": "10 + 2 is too hard >_<"
}
```

`concrete`的errorCode机制使用了`coodex-utilities`的`I18N`服务，很好的支持了国际化。
